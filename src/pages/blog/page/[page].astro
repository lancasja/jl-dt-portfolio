---
import { getCollection } from "astro:content";
import PageHeader from "@/components/elements/PageHeader.astro";
import BlogSection from "@/components/sections/BlogSection.astro";
import Layout from "@/layouts/Layout.astro";

// Posts per page
export const POSTS_PER_PAGE = 6;

// For SSG pagination, getStaticPaths() is still required (Astro v5/v6)
// so Astro knows which pages to generate at build time.
// params must be strings (v6 requirement).
export async function getStaticPaths() {
	const allPosts = await getCollection("post");

	// Sort by publish date
	let posts = allPosts.sort(
		(a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf(),
	);

	// Find featured post and remove from main list on list page
	const featuredPost = posts.find((post) => post.data.featured);
	if (featuredPost) {
		posts = posts.filter((post) => post.data.featured !== true);
	}

	// Total pages from post count after removing featured
	const totalPages = Math.ceil(posts.length / POSTS_PER_PAGE);

	// Return all pagination paths; params.page must be string (v6)
	return Array.from({ length: totalPages }, (_, i) => {
		const page = i + 1;
		return {
			params: { page: page.toString() },
			props: { page: page.toString() },
		};
	});
}

// Page number from props (set by getStaticPaths in SSG)
const { page } = Astro.props;
const currentPage = Number.parseInt(page);
---

<Layout title={`Blog - Page ${currentPage}`}>
  <section class="relative z-20 container mx-auto my-12 px-7 lg:px-0">
    <PageHeader
      title="Blog"
      description="Explore my thoughts on design and development, the convergence of thinking and innovation. Feel free to follow the updates!"
    />
  </section>
  <section class="relative z-20 mx-auto my-12 px-7 lg:px-0">
    <div class="mt-12">
      <BlogSection
        title="All Articles"
        listPage={true}
        pagination={{
          enable: true,
          currentPage: currentPage
        }}
        postsPerPage={POSTS_PER_PAGE}
      />
    </div>
  </section>
</Layout>