---
import projects from "@/collections/featuredwork.json";
import WorkCard from "@/components/cards/WorkCard.astro";
import SectionHeader from "@/components/elements/SectionHeader.astro";
import Button from "@/components/ui/Button.astro";

interface Props {
	title?: string;
	description?: string;
	showAll?: boolean;
	limit?: number; // Limit number of items to show
}

interface Project {
	name: string;
	description?: string;
	image: string;
	url: string;
	tags?: string[];
	video?: string;
	isShow?: boolean;
}

const {
	title = "Featured Work",
	description = "A selection of projects I've worked on. From web applications to design systems, each project represents a unique challenge and learning experience.",
	showAll = false,
	limit,
} = Astro.props;

// Get project list
let allProjects = projects as Project[];

// Control display count by limit or showAll
if (limit !== undefined) {
	// If limit is set, use it
	allProjects = projects.slice(0, limit) as Project[];
} else if (!showAll) {
	// If no limit and showAll is false, show 6 by default
	allProjects = projects.slice(0, 6) as Project[];
}
// If showAll is true and no limit, show all projects

// First three are featured (full width)
const featuredProjects = allProjects.slice(0, 3);

// Rest are grid items (two columns)
const gridProjects = allProjects.slice(3);

// Whether to show "View All" button
const shouldShowViewAll =
	limit !== undefined
		? limit < projects.length
		: !showAll && projects.length > 6;
---

<section class="py-16 md:py-16 md:pb-12">
  <div class="site-container space-y-8 md:space-y-8">
    <!-- Title section -->
    <SectionHeader title={title} description={description} />

    <!-- Featured projects - full width -->
    {featuredProjects.length > 0 && (
      <div class="space-y-8 md:space-y-10" data-aos-delay="750" data-aos="fade-up-sm" data-aos-duration="1000" data-aos-once="true">
        {featuredProjects
          .filter(project => project.isShow !== false)
          .map((project, index) => (
            <WorkCard
              name={project.name}
              description={project.description}
              image={project.image}
              url={project.url}
              tags={project.tags}
              video={project.video}
              isShow={project.isShow}
              layout="featured"
              index={index}
            />
          ))}
      </div>
    )}

    <!-- Grid projects - two columns -->
    {gridProjects.length > 0 && (
      <div class="grid gap-6 md:gap-8 md:grid-cols-2" data-aos-delay="150" data-aos="fade-up-sm" data-aos-duration="1000" data-aos-once="true">
        {gridProjects
          .filter(project => project.isShow !== false)
          .map((project, index) => (
            <WorkCard
              name={project.name}
              description={project.description}
              image={project.image}
              url={project.url}
              tags={project.tags}
              video={project.video}
              isShow={project.isShow}
              layout="grid"
              index={index}
            />
          ))}
      </div>
    )}

    <!-- See More button (optional) -->
    {shouldShowViewAll && (
      <div class="flex items-center justify-center pt-4">
        <Button url="/works" className="w-full max-w-60">
          See All Works
        </Button>
      </div>
    )}
  </div>
</section>
