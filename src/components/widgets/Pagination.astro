---
const { currentPage, totalPages, collection } = Astro.props;

// Build array of page numbers
const pageNumbers = Array.from({ length: totalPages }, (_, i) => i + 1);

// Determine visible page range
const maxVisiblePages = 5;
let startPage = Math.max(currentPage - Math.floor(maxVisiblePages / 2), 1);
const endPage = Math.min(startPage + maxVisiblePages - 1, totalPages);

if (endPage - startPage + 1 < maxVisiblePages) {
	startPage = Math.max(endPage - maxVisiblePages + 1, 1);
}

// Generate page link
const getPageLink = (pageNum: number): string => {
	if (pageNum === 1) {
		return `/${collection}/`;
	}
	return `/${collection}/page/${pageNum}`;
};
---

<nav aria-label="Pagination" class="flex justify-center mt-12">
  <ul class="flex items-center gap-1">
    <!-- Previous page button -->
    {currentPage > 1 ? (
      <li>
        <a
          href={getPageLink(currentPage - 1)}
          class="flex items-center justify-center w-10 h-10 rounded-md border border-neutral-200 dark:border-neutral-700 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors"
          aria-label="Go to previous page"
        >
          <span class="sr-only">Previous page</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="m15 18-6-6 6-6"></path>
          </svg>
        </a>
      </li>
    ) : (
      <li>
        <span
          class="flex items-center justify-center w-10 h-10 rounded-md border border-neutral-200 dark:border-neutral-700 text-neutral-400 dark:text-neutral-600 cursor-not-allowed"
          aria-disabled="true"
        >
          <span class="sr-only">Previous page</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="m15 18-6-6 6-6"></path>
          </svg>
        </span>
      </li>
    )}

    <!-- First page -->
    {startPage > 1 && (
      <>
        <li>
          <a
            href={getPageLink(1)}
            class="flex items-center justify-center w-10 h-10 rounded-md border border-neutral-200 dark:border-neutral-700 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors"
            aria-label="Go to page 1"
          >
            1
          </a>
        </li>
        {startPage > 2 && (
          <li>
            <span class="flex items-center justify-center w-10 h-10 text-neutral-500 dark:text-neutral-400">
              ...
            </span>
          </li>
        )}
      </>
    )}

    <!-- Page numbers -->
    {pageNumbers.slice(startPage - 1, endPage).map((pageNum) => (
      <li>
        <a
          href={getPageLink(pageNum)}
          class:list={[
            "flex items-center justify-center w-10 h-10 rounded-md border transition-colors",
            pageNum === currentPage
              ? "bg-primary text-white border-primary dark:bg-primary dark:border-primary"
              : "border-neutral-200 dark:border-neutral-700 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-800"
          ]}
          aria-label={`Go to page ${pageNum}`}
          aria-current={pageNum === currentPage ? "page" : undefined}
        >
          {pageNum}
        </a>
      </li>
    ))}

    <!-- Last page -->
    {endPage < totalPages && (
      <>
        {endPage < totalPages - 1 && (
          <li>
            <span class="flex items-center justify-center w-10 h-10 text-neutral-500 dark:text-neutral-400">
              ...
            </span>
          </li>
        )}
        <li>
          <a
            href={getPageLink(totalPages)}
            class="flex items-center justify-center w-10 h-10 rounded-md border border-neutral-200 dark:border-neutral-700 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors"
            aria-label={`Go to page ${totalPages}`}
          >
            {totalPages}
          </a>
        </li>
      </>
    )}

    <!-- Next page button -->
    {currentPage < totalPages ? (
      <li>
        <a
          href={getPageLink(currentPage + 1)}
          class="flex items-center justify-center w-10 h-10 rounded-md border border-neutral-200 dark:border-neutral-700 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors"
          aria-label="Go to next page"
        >
          <span class="sr-only">Next page</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="m9 18 6-6-6-6"></path>
          </svg>
        </a>
      </li>
    ) : (
      <li>
        <span
          class="flex items-center justify-center w-10 h-10 rounded-md border border-neutral-200 dark:border-neutral-700 text-neutral-400 dark:text-neutral-600 cursor-not-allowed"
          aria-disabled="true"
        >
          <span class="sr-only">Next page</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="m9 18 6-6-6-6"></path>
          </svg>
        </span>
      </li>
    )}
  </ul>
</nav>